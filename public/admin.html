<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Armory Admin</title>
  <link rel="stylesheet" href="adminstyles.css">
</head>
<body>

  <h1>Armory Admin</h1>
  <button id="clearData">Clear All Data</button>

  <!-- GLOBAL ABILITIES -->
  <h2>Global Abilities</h2>
  <!-- tabs -->
  <div id="globalTabs" class="global-tabs"></div>

  <!-- add form -->
  <form id="addGlobalAbilityForm" class="inline-form">
    <input id="newGlobalName"    placeholder="Name" required>
    <select id="newGlobalTab">
      <option value="0">Weapon</option>
      <option value="1">Ability</option>
      <option value="2">Survival</option>
    </select>
    <select id="newGlobalCat">
      <option value="common">Common</option>
      <option value="rare">Rare</option>
      <option value="epic">Epic</option>
    </select>
    <input id="newGlobalIcon"    placeholder="Icon URL" required>
    <input id="newGlobalCost"    type="number" placeholder="Cost" required>
    <input id="newGlobalTooltip" placeholder="Tooltip">
    <button type="submit" class="btn-add">Add Global</button>
  </form>

  <!-- list -->
  <div id="globalAbilitiesList" class="global-list"></div>

  <hr>

  <!-- HERO MANAGEMENT (unchanged) -->
  <h2>Add New Hero</h2>
  <form id="addHeroForm" class="inline-form">
    <input id="newHeroName" placeholder="Hero Name" required>
    <input id="newHeroAvatar" placeholder="Avatar URL">
    <button type="submit" class="btn-add">Add Hero</button>
  </form>

  <h2>Existing Heroes</h2>
  <div id="heroesList"></div>

<!-- 1) Auth0 SDK -->
<script src="https://cdn.auth0.com/js/auth0-spa-js/1.19/auth0-spa-js.production.js"></script>

<script>
  // Hide everything until we know if the user is logged in
  document.body.style.visibility = 'hidden';

  let auth0 = null;
  window.onload = async () => {
    // 2) Initialize Auth0 client
    auth0 = await createAuth0Client({
      domain:        'genai-32211481474906933.us.auth0.com',      // e.g. 'gr1zZtv.us.auth0.com'
      client_id:     'flwQvmWzV0SdoHGXk7tmji0mQJUdZWmb',   // e.g. 'ABC123xyz...'
      cacheLocation: 'localstorage',
      useRefreshTokens: true
    });

    // 3) Handle the redirect back from Auth0
    if (window.location.search.includes('code=') &&
        window.location.search.includes('state=')) {
      try {
        await auth0.handleRedirectCallback();
      } catch (err) {
        console.error('Error handling redirect callback:', err);
      }
      // clean up the URL
      window.history.replaceState({}, document.title, '/admin.html');
    }

    // 4) Check auth state
    const isAuthenticated = await auth0.isAuthenticated();
    if (!isAuthenticated) {
      // kick off the login redirect
      return auth0.loginWithRedirect({
        redirect_uri: window.location.origin + '/admin.html'
      });
    }

    // 5) If we get here, the user is logged in
    document.body.style.visibility = 'visible';
  };
</script>

<!-- your existing admin UI code -->
<script src="adminfunctions.js"></script>


<!-- admin.html (and likewise viewer.html) -->
  <script src="./initialData.js"></script>
  <script src="adminfunctions.js"></script>
</body>
</html>
