<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>User Profile</title>
  <link rel="stylesheet" href="profile.css">
</head>
<body>
  <header>
    <h1 id="lblName">Loading…</h1>
    <img id="imgAvatar" src="" alt="Avatar" hidden>
  </header>

  <section>
    <h2>About</h2>
    <p id="lblColor">Favorite color: <span id="clrDisplay"></span></p>
  </section>

  <script type="module">
    import { db } from './firebase-config.js';
    import { doc, getDoc }
      from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js';

    (async function() {
      const params = new URLSearchParams(location.search);
      const uid = params.get('uid');
      if (!uid) {
        document.body.textContent = 'No user specified.';
        return;
      }

      // fetch profile data
      const ref = doc(db, 'profiles', uid);
      const snap = await getDoc(ref);
      if (!snap.exists()) {
        document.getElementById('lblName').textContent = 'Unknown User';
        return;
      }

      const { displayName, color, avatarURL } = snap.data();
      document.getElementById('lblName').textContent = displayName || 'Unnamed';
      const img = document.getElementById('imgAvatar');
      img.src    = avatarURL || '/images/default-avatar.png';
      img.hidden = false;

      document.getElementById('clrDisplay').textContent = color || '—';
      document.body.style.setProperty('--accent', color || '#888');
    })();
  </script>
</body>
</html>
